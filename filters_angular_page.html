<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>My AngularJS App</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"
          type="text/css"/>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script data-require="angular.js@*" data-semver="1.2.0-rc3-nonmin"
            src="http://code.angularjs.org/1.2.0-rc.3/angular.js"></script>
    <script>
        var myApp = angular.module('myApp', []);
        myApp.controller('SampleController', function ($scope, $http, $filter) {
            $http.get('http://isa-api.herokuapp.com/transport/lines.json').then(function (res) {
                $scope.lines = res.data;
                $http.get('http://isa-api.herokuapp.com/transport/stops.json').then(function (res1) {
                    $scope.stops = res1.data;
                });
            });

            $scope.$watch('stopsFilter', function () {
                if ($scope.stopsFilter) {
                    var filteredLines = $filter('filter')($scope.lines, $scope.stopsFilter);
                    $scope.filteredLines = [];
                    filteredLines.forEach(function (item) {

                        var minutesToAdd = opoznienie / 60;
                        var secondsToAdd = opoznienie % 60;


                        var departures = [];
                        item.departures.forEach(function (departure) {
                            departures.push({
                                hours: departure.hour,
                                minutes: departure.minutes,
                                seconds: departure.seconds
                            });
                        });

                        var line = {
                            firstStop: item.stops[0].name,
                            lastStop: item.stops[item.stops.length - 1].name,
                            lineNo: item.name,
                            departures: departures
                        };
                        $scope.filteredLines.push(line);
                    });
                    console.log($scope.filteredLines);
                }
            });
        });
    </script>

</head>
<div ng-controller="SampleController">
    <br/>

    <div class="col-md-8 col-md-offset-2">
        <form class="form-horizontal" role="form">
            <div class="form-group">
                <label for="input2" class="col-sm-4 control-label">Wybierz przystanek</label>

                <div class="col-sm-6">
                    <select id="input2" class="form-control" ng-model="stopsFilter.stops ">
                        <option value="">Przystanki</option>
                        <option ng-repeat="item in stops" value="{{item.name}}">{{item.name}}</option>

                    </select>
                </div>
            </div>
        </form>
        <h3>Lista autobusów</h3>
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th>#</th>
                <th>Przystanek</th>
                <th>Nr linii</th>
                <th>Przystanek końcowy</th>
                <th>Godziny odjazdu</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="line in filteredLines">
                <td>{{$index + 1}}</td>
                <td>{{line.firstStop|uppercase }}</td>
                <td>{{ line.lineNo }}</td>
                <td>{{ line.lastStop|uppercase}}</td>
                <td>
                    <span ng-repeat="departure in line.departures">
                        {{departure.hours}}:{{departure.minutes}}:{{departure.seconds}},
                    </span>
                </td>
            </tr>
            </tbody>
        </table>

    </div>
</div>
</body>


</html>