<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>My AngularJS App</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"
          type="text/css"/>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script data-require="angular.js@*" data-semver="1.2.0-rc3-nonmin"
            src="http://code.angularjs.org/1.2.0-rc.3/angular.js"></script>
    <script>
        var myApp = angular.module('myApp', []);
        myApp.controller('SampleController', function ($scope, $http) {
            $http.get('http://isa-api.herokuapp.com/transport/lines.json').then(function (res) {
                $scope.lines = res.data;
                $http.get('http://isa-api.herokuapp.com/transport/stops.json').then(function (res1) {
                    $scope.stops = res1.data;

                    $scope.json_arr = res.data;
                    $scope.options =
                            $scope.num = function (arr) {
                                return arr.length > 2 ? 2 : 3;
                            };

                    myApp.filter('busFilter', [function($filter) {
                        return function(inputArray, searchCriteria, txnType){
                            if(!angular.isDefined(searchCriteria) || searchCriteria == ''){
                                return inputArray;
                            }
                            var data=[];
                            angular.forEach(inputArray, function(item){
                                if(item.txnType == txnType){
                                    if(item.payee.name.toLowerCase().indexOf(searchCriteria.toLowerCase()) != -1){
                                        data.push(item);
                                    }
                                }
                            });
                            return data;
                        };
                    }]);
                    $scope.count = true;
                    $scope.itemFilter = function (item) {
                        var filters = $scope.lines.filter(function (element, idx, array) {
                                    return element.selected;
                                }) || [];
                        var matched = true;
                        filters.forEach(function (line) {
                            matched = matched && item.attrs.indexOf(line.name) >= 0;
                        });
                        return matched;
                    };
                });
            });
        });
        //                });
    </script>

</head>
<div ng-controller="SampleController">
    <br/>
    <div class="col-md-8 col-md-offset-2">
        <form class="form-horizontal" role="form">
            <div class="form-group">
                <label for="input2" class="col-sm-4 control-label">Wybierz przystanek</label>
                <div class="col-sm-6">
                    <select id="input2" class="form-control" ng-model="filterTxn.stops ">
                        <option value="">Przystanki</option>
                        <option ng-repeat="item in stops" value="{{item.name}}">{{item.name}}</option>

                    </select>
                </div>
            </div>
        </form>
        <h3>Lista autobusów</h3>
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th>#</th>
                <th>Przystanek</th>
                <th>Nr linii</th>
                <th>Przystanek końcowy</th>
                <th>Godziny odjazdu</th>
            </tr>
            </thead>
            <tbody>
            <!--<tr ng-repeat="vals in json_arr| filter: filterTxn | 'name'">-->
            <tr ng-repeat="vals in json_arr | filter:filterTxn ">
                <td>{{$index + 1}}</td>
                <td>{{vals.stops[0].name|uppercase }}</td>
                <td>{{ vals.name }}</td>
                <td>{{ vals.stops[vals.stops.length-1].name|uppercase}}</td>
                <td>{{vals.departures[0].hour}}:{{vals.departures[0].minutes}}:{{vals.departures[0].seconds}}</td>
            </tr>
            </tbody>
        </table>

        <div class="panel panel-success" ng-repeat="vals in json_arr">
            <p>Przystanek: {{vals.stops[0].name }}</p>
            <p>Nr autobusu: {{ vals.name }}</p>
            <p>Dokąd jedzie: {{ vals.stops[vals.stops.length-1].name}}</p>
            <p>Godziny: {{vals.departures[0].hour}}:{{vals.departures[0].minutes}}:{{vals.departures[0].seconds}} </p>
        </div>
        <div ng-repeat="vals in json_arr ">Godziny:
            {{vals.departures.hour}}:{{vals.departures.minutes}}:{{vals.departures.seconds}}
        </div>

        <div class="subtitle">Select categories to filter cards</div>
        <div class="options_container">
            <label ng-repeat="option in options" class="option" id="option">
                <input type="checkbox" class="check" ng-model="option.selected"/>
                <span>{{option.name | uppercase}}</span>

            </label>
        </div>
        <!--<div class="cards" id="cards">-->
        <!--<div ng-repeat="card in cards | filter:itemFilter" class="card_background">-->
        <!--<div class="card_title">{{card.name | uppercase}}</div>-->
        <!--<div class="card_properties">-->
        <!--<div ng-repeat="attr in card.attrs">{{attr}} <span class="card_properties_number">+{{num(card.attrs)}}</span>-->

        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <script src="ang.js"></script>
        </body>

    </div>

</div>
</html>